<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BentoGrid Generator</title>
    <link rel="stylesheet" href="style.css">
    <script src="CSInterface.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>BentoGrid Generator</h1>
            <p class="subtitle">Real-time grid generation in Illustrator</p>
        </header>

        <section class="section">
            <h2>Dimensions</h2>
            <div class="control-group">
                <label for="widthSlider">Width: <span id="widthValue">800</span> px</label>
                <input type="range" id="widthSlider" min="200" max="1920" value="800" step="10">
            </div>
            <div class="control-group">
                <label for="heightSlider">Height: <span id="heightValue">600</span> px</label>
                <input type="range" id="heightSlider" min="200" max="1920" value="600" step="10">
            </div>
        </section>

        <section class="section">
            <h2>Density & Style</h2>
            <div class="control-group">
                <label for="densitySlider">Density: <span id="densityValue">6</span> divisions</label>
                <input type="range" id="densitySlider" min="2" max="12" value="6" step="1">
            </div>
            <div class="control-group">
                <label for="gutterSlider">Gutter: <span id="gutterValue">15</span> px</label>
                <input type="range" id="gutterSlider" min="0" max="50" value="15" step="1">
            </div>
            <div class="control-group">
                <label for="radiusSlider">Corner Radius: <span id="radiusValue">20</span> px</label>
                <input type="range" id="radiusSlider" min="0" max="100" value="20" step="1">
            </div>
        </section>

        <section class="section actions">
            <button id="remixBtn" class="btn secondary">Remix Layout ðŸŽ²</button>
            <button id="finalizeBtn" class="btn success">Finalize Grid</button>
            <button id="insertContentBtn" class="btn info">Insert Content</button>
            <button id="clearBtn" class="btn danger">Clear Grid</button>
        </section>

        <section class="section preview-section">
            <h2>Live Preview</h2>
            <div class="preview-container">
                <!-- Preview will be generated by JavaScript -->
                <canvas id="previewCanvas" width="280" height="160"></canvas>
            </div>
        </section>

        <footer class="status-bar">
            <div id="statusMessage">Ready. Adjust sliders to generate grid.</div>
            <div class="progress-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
        </footer>
    </div>

    <script>
        // Main JavaScript for the panel
        var csInterface = new CSInterface();

        // Get DOM elements
        var widthSlider = document.getElementById('widthSlider');
        var heightSlider = document.getElementById('heightSlider');
        var densitySlider = document.getElementById('densitySlider');
        var gutterSlider = document.getElementById('gutterSlider');
        var radiusSlider = document.getElementById('radiusSlider');

        var widthValue = document.getElementById('widthValue');
        var heightValue = document.getElementById('heightValue');
        var densityValue = document.getElementById('densityValue');
        var gutterValue = document.getElementById('gutterValue');
        var radiusValue = document.getElementById('radiusValue');

        var remixBtn = document.getElementById('remixBtn');
        var finalizeBtn = document.getElementById('finalizeBtn');
        var insertContentBtn = document.getElementById('insertContentBtn');
        var clearBtn = document.getElementById('clearBtn');

        var statusMessage = document.getElementById('statusMessage');
        var progressBar = document.getElementById('progressBar');

        // Current settings
        var currentSettings = {
            width: 800,
            height: 600,
            density: 6,
            gutter: 15,
            radius: 20
        };

        // Debounce timer
        var generateTimer = null;

        // Update settings and trigger generation
        function updateSetting(key, value) {
            currentSettings[key] = value;
            queueGeneration();
        }

        // Queue generation with debounce
        function queueGeneration() {
            if (generateTimer) {
                clearTimeout(generateTimer);
            }
            showProgress('Generating...', 30);
            generateTimer = setTimeout(function() {
                generateGrid();
            }, 300);
        }

        // Generate grid in Illustrator
        function generateGrid() {
            var script = "generateBentoGrid(" + JSON.stringify(currentSettings) + ")";
            csInterface.evalScript(script, function(result) {
                if (result) {
                    showProgress(result, 100);
                    // Reset progress after 2 seconds
                    setTimeout(function() {
                        showProgress('Ready', 0);
                    }, 2000);
                }
            });
        }

        // Remix layout
        remixBtn.addEventListener('click', function() {
            // Randomize density, gutter, and radius
            currentSettings.density = Math.floor(Math.random() * 11) + 2; // 2 to 12
            currentSettings.gutter = Math.floor(Math.random() * 51); // 0 to 50
            currentSettings.radius = Math.floor(Math.random() * 101); // 0 to 100

            // Update sliders and values
            densitySlider.value = currentSettings.density;
            gutterSlider.value = currentSettings.gutter;
            radiusSlider.value = currentSettings.radius;

            densityValue.textContent = currentSettings.density;
            gutterValue.textContent = currentSettings.gutter;
            radiusValue.textContent = currentSettings.radius;

            queueGeneration();
        });

        // Finalize grid
        finalizeBtn.addEventListener('click', function() {
            var script = "finalizeBentoGrid()";
            csInterface.evalScript(script, function(result) {
                if (result) {
                    showProgress(result, 100);
                }
            });
        });

        // Insert content
        insertContentBtn.addEventListener('click', function() {
            var script = "insertContent()";
            csInterface.evalScript(script, function(result) {
                if (result) {
                    showProgress(result, 100);
                }
            });
        });

        // Clear grid
        clearBtn.addEventListener('click', function() {
            var script = "clearBentoGrid()";
            csInterface.evalScript(script, function(result) {
                if (result) {
                    showProgress(result, 100);
                }
            });
        });

        // Slider events
        widthSlider.addEventListener('input', function() {
            var value = parseInt(this.value);
            widthValue.textContent = value;
            updateSetting('width', value);
        });

        heightSlider.addEventListener('input', function() {
            var value = parseInt(this.value);
            heightValue.textContent = value;
            updateSetting('height', value);
        });

        densitySlider.addEventListener('input', function() {
            var value = parseInt(this.value);
            densityValue.textContent = value;
            updateSetting('density', value);
        });

        gutterSlider.addEventListener('input', function() {
            var value = parseInt(this.value);
            gutterValue.textContent = value;
            updateSetting('gutter', value);
        });

        radiusSlider.addEventListener('input', function() {
            var value = parseInt(this.value);
            radiusValue.textContent = value;
            updateSetting('radius', value);
        });

        // Show progress in status bar
        function showProgress(message, percentage) {
            statusMessage.textContent = message;
            progressBar.style.width = percentage + '%';
        }

        // Initial generation
        generateGrid();
    </script>
</body>
</html>
